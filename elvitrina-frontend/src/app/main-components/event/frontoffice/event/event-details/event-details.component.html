<div *ngIf="loading" class="loading-container">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Loading event details...</p>
</div>

<div *ngIf="!loading && event" class="event-details-container">
  <!-- Event Overview -->
  <section class="event-overview">
    <mat-card class="overview-card">
      <mat-card-content>
        <h1 class="event-title">{{ event.title }}</h1>
        <p class="event-description">{{ event.description }}</p>
        <div class="event-meta">
          <span><mat-icon>event</mat-icon> {{ event.startDateTime | date:'medium' }}</span>
          <span><mat-icon>attach_money</mat-icon> {{ event.ticketPrice | currency }}</span>
          <span><mat-icon>group</mat-icon> Max: {{ event.maxParticipants }}</span>
          <span><mat-icon>live_tv</mat-icon> {{ event.eventType }} / {{ event.eventMode }}</span>
        </div>
      </mat-card-content>
      
  
 
      <!-- In your event-details.component.html, inside the mat-card-actions -->
      <mat-card-actions>
        <ng-container *ngIf="!hasUserJoined(); else alreadyJoined">
         
        </ng-container>
        <ng-template #alreadyJoined>
          <span style="display: flex; align-items: center; color: green;">
            <mat-icon>check_circle</mat-icon>
            <span style="margin-left: 8px;">You have joined this event</span>
          </span>
        </ng-template>
      </mat-card-actions>
    </mat-card>
  </section>
  
  <!-- Calendar -->
  <section class="calendar-section">
    <h2 class="section-title">
      Event Calendar
    </h2>
    <mat-card class="calendar-card">
      <mat-card-content>
        <div *ngIf="role === 'seller' && !googleEventsLoaded" class="loading-calendar">
          <mat-spinner diameter="30"></mat-spinner>
          <span>Loading Google Calendar events...</span>
        </div>
        <app-calendar [calendarEvents]="displayedCalendarEvents" [role]="role" [eventId]="event.eventId"></app-calendar>
      </mat-card-content>
    </mat-card>
  </section>
  
  <!-- Timeline -->
  <section class="timeline-section">
    <h2 class="section-title">Event Timeline</h2>
    <div class="timeline-container">
      <mat-card *ngFor="let session of event.sessions; let i = index" class="timeline-card" 
                [ngClass]="getTimelineCardClass(getSessionStatus(session))">
        <mat-card-content>
          <div class="timeline-header">
            <span class="timeline-day">Day {{ i + 1 }}</span>
            <mat-icon [ngClass]="getSessionStatus(session) === 'done' ? 'done' : 'upcoming'">
              {{ getSessionStatus(session) === 'done' ? 'check_circle' : 'schedule' }}
            </mat-icon>
          </div>
          <h3 class="timeline-title">{{ session.sessionTitle }}</h3>
          <p class="timeline-time">
            {{ session.startTime | date:'medium' }}
            <span *ngIf="session.endTime"> - {{ session.endTime | date:'medium' }}</span>
          </p>
        </mat-card-content>
      </mat-card>
    </div>
  </section>
  
  <!-- Participants -->
  <section class="participants-section">
    <h2 class="section-title">People Joined</h2>
    <div class="participants-list">
      <ng-container *ngFor="let participant of event.participants">
        <div class="participant-avatar" [matTooltip]="participant.userName || 'Unknown'">
          <img *ngIf="participant.userImage; else initials" [src]="participant.userImage" alt="avatar">
          <ng-template #initials>
            <span>{{ participant.userName ? participant.userName[0] : '?' }}</span>
          </ng-template>
        </div>
      </ng-container>
      <span *ngIf="!event.participants || event.participants.length === 0" class="no-participants">
        No participants yet.
      </span>
    </div>
  </section>
</div>

<div *ngIf="!loading && !event" class="no-data-message">
  <mat-icon>error_outline</mat-icon>
  <p>Event not found.</p>
</div>