<mat-horizontal-stepper linear>

  <!-- STEP 1: S√©lection de la m√©thode de paiement -->
  <mat-step [stepControl]="paymentFormGroup">
    <form [formGroup]="paymentFormGroup">
      <ng-template matStepLabel>M√©thode de paiement</ng-template>

      <mat-radio-group formControlName="paymentMethod" (change)="onPaymentMethodChange($event.value)">
        <mat-radio-button [value]="PaymentMethodType.CASHONDELIVER">Paiement √† la livraison</mat-radio-button>
        <mat-radio-button [value]="PaymentMethodType.CREDIT_CARD">Carte Bancaire</mat-radio-button>
      </mat-radio-group>

      <div class="step-actions">
        <button mat-raised-button color="primary" matStepperNext>Suivant</button>
      </div>
    </form>
  </mat-step>
 <!-- STEP 2: Formulaire de cr√©ation de paiement -->
 <mat-step [stepControl]="paymentFormGroup">
  <ng-template matStepLabel>Cr√©ation du paiement</ng-template>
  <app-payement-creation [selectedPaymentMethod]="selectedPaymentMethod"></app-payement-creation>

  <div class="step-actions">
    <button mat-button matStepperPrevious>Retour</button>
    <button mat-raised-button color="primary" matStepperNext>Suivant</button>
  </div>
</mat-step>
  <!-- STEP 2: Informations personnelles ou Livraison selon la m√©thode choisie -->
  <mat-step [stepControl]="selectedPaymentMethod === PaymentMethodType.CASHONDELIVER ? personalInfoFormGroup : deliveryFormGroup">
    <form [formGroup]="selectedPaymentMethod === PaymentMethodType.CASHONDELIVER ? personalInfoFormGroup : deliveryFormGroup">
      <ng-template matStepLabel>
        {{ selectedPaymentMethod === PaymentMethodType.CASHONDELIVER ? 'Informations personnelles' : 'Livraison' }}
      </ng-template>

      <!-- Informations personnelles -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nom complet</mat-label>
        <input matInput formControlName="fullName" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>T√©l√©phone</mat-label>
        <input matInput formControlName="phone" />
      </mat-form-field>

      <!-- Si paiement √† la livraison, ajout de l'email -->
      <ng-container *ngIf="selectedPaymentMethod === PaymentMethodType.CASHONDELIVER">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" />
        </mat-form-field>
      </ng-container>

      <!-- Adresse et carte -->

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Adresse</mat-label>
        <textarea matInput formControlName="address"></textarea>
      </mat-form-field>

      <app-leaflet-map (addressSelected)="handleMapAddress($event)"></app-leaflet-map>

      <!-- Livraison pour m√©thode autre que paiement √† la livraison -->
      <div *ngIf="selectedPaymentMethod !== PaymentMethodType.CASHONDELIVER">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Adresse de livraison</mat-label>
          <textarea matInput formControlName="deliveryAddress"></textarea>
        </mat-form-field>
      </div>

      <div class="step-actions">
        <button mat-button matStepperPrevious>Retour</button>
        <button mat-raised-button color="primary" matStepperNext>Suivant</button>
      </div>
    </form>
  </mat-step>

  <!-- STEP 3: Paiement s√©curis√© uniquement pour carte bancaire ou PayPal -->
  <mat-step *ngIf="selectedPaymentMethod !== PaymentMethodType.CASHONDELIVER" [stepControl]="creditCardFormGroup">
    <form [formGroup]="creditCardFormGroup">
      <ng-template matStepLabel>Paiement s√©curis√©</ng-template>

      <!-- Int√©gration Stripe pour la carte bancaire -->
      <app-payment></app-payment>
      <div class="step-actions">
        <button mat-button matStepperPrevious>Retour</button>
        <!-- <button mat-raised-button color="primary" (click)="pay()">Payer</button> -->
      </div>
    </form>
  </mat-step>

  <!-- STEP 4: R√©sum√© de la commande -->
  <mat-step>
    <ng-template matStepLabel>R√©sum√© de commande</ng-template>

    <p><strong>Nom :</strong> {{ personalInfoFormGroup.value.fullName }}</p>
    <p><strong>T√©l√©phone :</strong> {{ personalInfoFormGroup.value.phone }}</p>
    <p><strong>Email :</strong> {{ personalInfoFormGroup.value.email }}</p>
    <p><strong>Adresse :</strong> {{ personalInfoFormGroup.value.address }}</p>

    <div class="step-actions">
      <button mat-button matStepperPrevious>Retour</button>
      <button mat-raised-button color="accent" matStepperNext>Confirmer</button>
    </div>
  </mat-step>

  <!-- STEP 5: Confirmation -->
  <mat-step>
    <ng-template matStepLabel>Confirmation</ng-template>
    <p>Merci pour votre commande üõí !</p>
  </mat-step>

</mat-horizontal-stepper>
