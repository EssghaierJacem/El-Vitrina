<mat-horizontal-stepper linear #stepper>
  <!-- STEP 1 : Choix + Cr√©ation du paiement -->
  <mat-step [completed]="paymentCreated">
    <ng-template matStepLabel>M√©thode de paiement</ng-template>

    <!-- M√©thode de paiement -->
    <mat-radio-group [(ngModel)]="selectedPaymentMethod" (change)="onPaymentMethodSelected($event)" class="mb-3">
      <mat-radio-button [value]="PaymentMethodType.CASHONDELIVER">Paiement √† la livraison</mat-radio-button>
      <mat-radio-button [value]="PaymentMethodType.CREDIT_CARD">Carte Bancaire</mat-radio-button>
    </mat-radio-group>

    <!-- Formulaire affich√© apr√®s choix -->
    <app-payement-creation
      *ngIf="selectedPaymentMethod"
      [stepper]="stepper"
      [selectedMethod]="selectedPaymentMethod"
      (paymentCreated)="onPaymentCreated($event)">
    </app-payement-creation>

    <div class="step-actions">
      <button mat-raised-button color="primary" matStepperNext [disabled]="!paymentCreated">Suivant</button>
    </div>
  </mat-step>

  <!-- STEP 2 : Infos perso ou Livraison -->
  <mat-step
    *ngIf="paymentCreated"
    [stepControl]="selectedPaymentMethod === PaymentMethodType.CASHONDELIVER ? personalInfoFormGroup : deliveryFormGroup">

    <form [formGroup]="selectedPaymentMethod === PaymentMethodType.CASHONDELIVER ? personalInfoFormGroup : deliveryFormGroup">
      <ng-template matStepLabel>
        {{ selectedPaymentMethod === PaymentMethodType.CASHONDELIVER ? 'Informations personnelles' : 'Livraison' }}
      </ng-template>

      <!-- Nom complet -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nom complet</mat-label>
        <input matInput formControlName="fullName" />
      </mat-form-field>

      <!-- T√©l√©phone -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>T√©l√©phone</mat-label>
        <input matInput formControlName="phone" />
      </mat-form-field>

      <!-- Email si CASH ON DELIVERY -->
      <ng-container *ngIf="selectedPaymentMethod === PaymentMethodType.CASHONDELIVER">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" />
        </mat-form-field>
      </ng-container>

      <!-- Adresse -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Adresse</mat-label>
        <textarea matInput formControlName="address"></textarea>
      </mat-form-field>

      <app-leaflet-map (addressSelected)="handleMapAddress($event)"></app-leaflet-map>

      <!-- Adresse de livraison si autre m√©thode -->
      <div *ngIf="selectedPaymentMethod !== PaymentMethodType.CASHONDELIVER">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Adresse de livraison</mat-label>
          <textarea matInput formControlName="deliveryAddress"></textarea>
        </mat-form-field>
      </div>

      <div class="step-actions">
        <button mat-button matStepperPrevious>Retour</button>
        <button mat-raised-button color="primary" matStepperNext>Suivant</button>
      </div>
    </form>
  </mat-step>

  <!-- STEP 3 : Paiement s√©curis√© -->
  <ng-container *ngIf="selectedPaymentMethod !== PaymentMethodType.CASHONDELIVER">
    <mat-step [stepControl]="creditCardFormGroup">
      <form [formGroup]="creditCardFormGroup">
        <ng-template matStepLabel>Paiement s√©curis√©</ng-template>

        <app-payment></app-payment>

        <div class="step-actions">
          <button mat-button matStepperPrevious>Retour</button>
          <button mat-raised-button color="primary" matStepperNext>Suivant</button>
        </div>
      </form>
    </mat-step>
  </ng-container>

  <!-- STEP 4 : R√©sum√© -->
  <mat-step>
    <ng-template matStepLabel>R√©sum√© de commande</ng-template>

    <p><strong>Nom :</strong> {{ personalInfoFormGroup.value.fullName }}</p>
    <p><strong>T√©l√©phone :</strong> {{ personalInfoFormGroup.value.phone }}</p>
    <p><strong>Email :</strong> {{ personalInfoFormGroup.value.email }}</p>
    <p><strong>Adresse :</strong> {{ personalInfoFormGroup.value.address }}</p>

    <div class="step-actions">
      <button mat-button matStepperPrevious>Retour</button>
      <button mat-raised-button color="accent" matStepperNext>Confirmer</button>
    </div>
  </mat-step>

  <!-- STEP 5 : Confirmation -->
  <mat-step>
    <ng-template matStepLabel>Confirmation</ng-template>
    <p>Merci pour votre commande üõí !</p>
  </mat-step>
</mat-horizontal-stepper>
